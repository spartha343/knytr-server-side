// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                       String            @id @default(uuid())
  email                    String?
  firebaseUid              String            @unique
  status                   UserStatus        @default(ACTIVE)
  createdAt                DateTime          @default(now())
  updatedAt                DateTime          @updatedAt
  userRoles                UserRole[]
  roleRequests             RoleRequest[]
  stores                   Store[]
  categoryRequests         CategoryRequest[] @relation("RequestedCategories")
  reviewedCategoryRequests CategoryRequest[] @relation("ReviewedRequests")
  cart                     Cart?
  orders                   Order[]
  orderActivities          OrderActivity[]
  cancelledOrders          Order[]           @relation("CancelledOrders")

  @@map("users")
}

model Role {
  id           String        @id @default(uuid())
  name         RoleType      @unique
  description  String?
  userRoles    UserRole[]
  roleRequests RoleRequest[]

  @@map("roles")
}

model UserRole {
  userId String
  roleId String

  user User @relation(fields: [userId], references: [id])
  role Role @relation(fields: [roleId], references: [id])

  @@id([userId, roleId])
  @@map("user_roles")
}

model RoleRequest {
  id        String            @id @default(uuid())
  userId    String
  roleId    String
  status    RoleRequestStatus @default(PENDING)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  user User @relation(fields: [userId], references: [id])
  role Role @relation(fields: [roleId], references: [id])

  @@unique([userId, roleId], name: "userId_roleId")
  @@map("role_requests")
}

model Store {
  id          String  @id @default(uuid())
  name        String
  slug        String  @unique
  description String? @db.Text
  logo        String?
  banner      String?
  vendorId    String
  isActive    Boolean @default(true)

  // Soft delete fields
  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  // SEO fields
  seoTitle       String?
  seoDescription String?
  seoKeywords    String?

  //  Vendor Contact Information (NEW - Add these 3 lines)
  whatsappNumber String? // Format: +8801XXXXXXXXX or 01XXXXXXXXX
  messengerLink  String? // Format: https://m.me/username or fb.com/username
  contactPhone   String? // Primary phone for customer contact
  orders         Order[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  vendor   User      @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  branches Branch[]
  products Product[]

  @@index([vendorId])
  @@index([slug])
  @@index([isActive])
  @@index([isDeleted])
  @@index([whatsappNumber])
}

model Branch {
  id           String  @id @default(uuid())
  name         String
  storeId      String
  contactPhone String?
  contactEmail String?
  isActive     Boolean @default(true)

  // Soft delete
  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  store             Store             @relation(fields: [storeId], references: [id], onDelete: Cascade)
  address           Address?
  inventories       Inventory[]
  orderItems        OrderItem[]
  orders            Order[]
  pathaoStore       PathaoStore?
  pathaoCredentials PathaoCredential?

  @@index([storeId])
  @@index([isDeleted])
}

model Address {
  id           String  @id @default(uuid())
  branchId     String  @unique
  addressLine1 String
  addressLine2 String?
  city         String
  state        String?
  postalCode   String
  country      String  @default("Bangladesh")

  // Location coordinates (for map & location-based search)
  latitude  Float?
  longitude Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)

  @@index([branchId])
  @@index([latitude, longitude]) // Add compound index for location queries
}

model Category {
  id          String  @id @default(uuid())
  name        String
  slug        String  @unique
  description String? @db.Text
  imageUrl    String?
  parentId    String?
  isActive    Boolean @default(true)

  // Soft delete
  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  // SEO
  seoTitle       String?
  seoDescription String?
  seoKeywords    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  parent           Category?         @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: Restrict)
  children         Category[]        @relation("CategoryHierarchy")
  categoryRequests CategoryRequest[]
  products         Product[]

  @@index([parentId])
  @@index([slug])
  @@index([isActive])
  @@index([isDeleted])
  @@map("categories")
}

model CategoryRequest {
  id          String                @id @default(uuid())
  name        String
  description String?               @db.Text
  parentId    String?
  requestedBy String
  status      CategoryRequestStatus @default(PENDING)

  // Admin response
  reviewedBy String?
  reviewNote String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  vendor   User      @relation("RequestedCategories", fields: [requestedBy], references: [id])
  parent   Category? @relation(fields: [parentId], references: [id])
  reviewer User?     @relation("ReviewedRequests", fields: [reviewedBy], references: [id])

  @@index([requestedBy])
  @@index([status])
  @@index([parentId])
  @@map("category_requests")
}

model Brand {
  id          String  @id @default(uuid())
  name        String  @unique
  slug        String  @unique
  description String? @db.Text
  logoUrl     String?
  websiteUrl  String?
  isActive    Boolean @default(true)

  // Soft delete
  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  // SEO
  seoTitle       String?
  seoDescription String?
  seoKeywords    String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]

  @@index([slug])
  @@index([isActive])
  @@index([isDeleted])
  @@map("brands")
}

model Product {
  id          String  @id @default(uuid())
  name        String
  slug        String
  description String? @db.Text

  basePrice    Decimal  @db.Decimal(10, 2)
  comparePrice Decimal? @db.Decimal(10, 2)

  categoryId String
  brandId    String?
  storeId    String

  isActive    Boolean @default(true)
  isPublished Boolean @default(false)
  isFeatured  Boolean @default(false)

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  seoTitle       String?
  seoDescription String?
  seoKeywords    String?

  weight       Decimal? @db.Decimal(10, 2)
  length       Decimal? @db.Decimal(10, 2)
  width        Decimal? @db.Decimal(10, 2)
  height       Decimal? @db.Decimal(10, 2)
  freeShipping Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  category          Category           @relation(fields: [categoryId], references: [id])
  brand             Brand?             @relation(fields: [brandId], references: [id])
  store             Store              @relation(fields: [storeId], references: [id])
  media             ProductMedia[]
  variants          ProductVariant[]
  productAttributes ProductAttribute[]
  sections          ProductSection[]
  cartItems         CartItem[]
  orderItems        OrderItem[]

  @@unique([storeId, slug], name: "store_product_slug")
  @@index([categoryId])
  @@index([brandId])
  @@index([storeId])
  @@index([slug])
  @@index([isPublished])
  @@index([isFeatured])
  @@map("products")
}

model ProductMedia {
  id        String @id @default(uuid())
  productId String

  mediaType String
  mediaUrl  String
  altText   String?

  isPrimary Boolean @default(false)
  order     Int     @default(0)

  metadata Json?

  createdAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([isPrimary])
  @@index([order])
  @@map("product_media")
}

model ProductSection {
  id        String @id @default(uuid())
  productId String

  title String
  type  String
  order Int    @default(0)

  isVisible Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product              @relation(fields: [productId], references: [id], onDelete: Cascade)
  items   ProductSectionItem[]

  @@index([productId])
  @@index([order])
  @@map("product_sections")
}

model ProductSectionItem {
  id        String @id @default(uuid())
  sectionId String

  label String?
  value String
  order Int     @default(0)

  section ProductSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@index([sectionId])
  @@index([order])
  @@map("product_section_items")
}

model Attribute {
  id          String  @id @default(uuid())
  name        String  @unique
  displayName String?
  type        String  @default("text")
  isActive    Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  values            AttributeValue[]
  productAttributes ProductAttribute[]

  @@map("attributes")
}

model AttributeValue {
  id          String  @id @default(uuid())
  attributeId String
  value       String
  colorCode   String?
  imageUrl    String?

  createdAt DateTime @default(now())

  attribute         Attribute          @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  variantAttributes VariantAttribute[]

  @@unique([attributeId, value])
  @@index([attributeId])
  @@map("attribute_values")
}

model ProductAttribute {
  productId   String
  attributeId String

  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  attribute Attribute @relation(fields: [attributeId], references: [id], onDelete: Cascade)

  @@id([productId, attributeId])
  @@map("product_attributes")
}

model ProductVariant {
  id           String   @id @default(uuid())
  productId    String
  sku          String   @unique
  price        Decimal  @db.Decimal(10, 2)
  comparePrice Decimal? @db.Decimal(10, 2)
  isActive     Boolean  @default(true)

  imageUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product           Product            @relation(fields: [productId], references: [id], onDelete: Cascade)
  variantAttributes VariantAttribute[]
  inventories       Inventory[]
  cartItems         CartItem[]
  orderItems        OrderItem[]

  @@index([productId])
  @@index([sku])
  @@map("product_variants")
}

model VariantAttribute {
  variantId        String
  attributeValueId String

  variant        ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  attributeValue AttributeValue @relation(fields: [attributeValueId], references: [id], onDelete: Cascade)

  @@id([variantId, attributeValueId])
  @@map("variant_attributes")
}

model Inventory {
  id        String @id @default(uuid())
  variantId String
  branchId  String

  quantity      Int @default(0)
  reservedQty   Int @default(0)
  lowStockAlert Int @default(10)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  branch  Branch         @relation(fields: [branchId], references: [id], onDelete: Cascade)

  @@unique([variantId, branchId])
  @@index([variantId])
  @@index([branchId])
  @@index([quantity])
  @@map("inventories")
}

model Cart {
  id     String @id @default(uuid())
  userId String @unique

  items CartItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("carts")
}

model CartItem {
  id        String  @id @default(uuid())
  cartId    String
  productId String
  variantId String?
  quantity  Int     @default(1)

  // Price snapshot (in case product price changes later)
  priceSnapshot Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cart    Cart            @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product Product         @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])

  @@unique([cartId, productId, variantId])
  @@index([cartId])
  @@index([productId])
  @@map("cart_items")
}

model Order {
  id          String @id @default(uuid())
  orderNumber String @unique // AUTO: ORD-{store-slug}-YYYYMMDD-0000001

  // Customer Info (Phone is REQUIRED, rest optional)
  customerPhone  String // REQUIRED - for voice confirmation
  customerName   String?
  customerEmail  String?
  secondaryPhone String? // Alternate contact number

  // Delivery Info
  recipientCityId     Int?             @map("recipient_city_id")
  recipientZoneId     Int?             @map("recipient_zone_id")
  recipientAreaId     Int?             @map("recipient_area_id")
  deliveryAddress     String?
  deliveryLocation    DeliveryLocation // INSIDE_DHAKA or OUTSIDE_DHAKA
  deliveryCharge      Decimal          @db.Decimal(10, 2) // 70 or 120 BDT based on location (configurable)
  specialInstructions String?          @db.Text // "Call before delivery", "Leave at gate", etc.

  // Order Details
  userId        String? // null for guest orders
  storeId       String // Which store this order belongs to
  status        OrderStatus   @default(PENDING)
  paymentMethod PaymentMethod @default(COD)

  // Pricing
  subtotal      Decimal @db.Decimal(10, 2) // Sum of all items
  totalDiscount Decimal @db.Decimal(10, 2) // Total savings
  totalAmount   Decimal @db.Decimal(10, 2) // subtotal - totalDiscount + deliveryCharge

  // Branch Assignment
  assignedBranchId   String? // Which branch fulfills this order
  cancellationReason String?   @db.Text
  cancelledBy        String?
  cancelledAt        DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user            User?           @relation(fields: [userId], references: [id])
  store           Store           @relation(fields: [storeId], references: [id])
  assignedBranch  Branch?         @relation(fields: [assignedBranchId], references: [id])
  items           OrderItem[]
  pathaoDelivery  PathaoDelivery?
  recipientCity   PathaoCity?     @relation("OrderRecipientCity", fields: [recipientCityId], references: [cityId], onDelete: SetNull)
  recipientZone   PathaoZone?     @relation("OrderRecipientZone", fields: [recipientZoneId], references: [zoneId], onDelete: SetNull)
  recipientArea   PathaoArea?     @relation("OrderRecipientArea", fields: [recipientAreaId], references: [areaId], onDelete: SetNull)
  activities      OrderActivity[]
  cancelledByUser User?           @relation("CancelledOrders", fields: [cancelledBy], references: [id])

  @@index([userId])
  @@index([storeId])
  @@index([status])
  @@index([orderNumber])
  @@index([customerPhone])
  @@index([storeId, status])
  @@index([userId, status])
  @@index([storeId, createdAt])
  @@index([createdAt])
  @@index([assignedBranchId])
  @@index([recipientCityId])
  @@index([recipientZoneId])
  @@index([recipientAreaId])
  @@map("orders")
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String
  productId String
  variantId String?
  branchId  String? // Nullable - Vendor assigns this later

  quantity Int
  price    Decimal @db.Decimal(10, 2)
  discount Decimal @default(0) @db.Decimal(10, 2) // Discount at time of order
  total    Decimal @db.Decimal(10, 2) // (price - discount) * quantity

  // Snapshot data (in case product/variant deleted)
  productName  String
  variantName  String?
  productImage String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  order   Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product         @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])
  branch  Branch?         @relation(fields: [branchId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@index([branchId])
  @@map("order_items")
}

// ============================================
// PATHAO COURIER INTEGRATION MODELS
// ============================================

model PathaoCredential {
  id String @id @default(uuid())

  // Link to branch (each branch has its own Pathao credentials)
  branchId String @map("branch_id")
  branch   Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)

  clientId     String @map("client_id")
  clientSecret String @map("client_secret")
  username     String
  password     String

  // Token management
  accessToken  String?   @map("access_token") @db.Text
  refreshToken String?   @map("refresh_token") @db.Text
  tokenExpiry  DateTime? @map("token_expiry")

  // Webhook security
  webhookSecret String? @map("webhook_secret")

  environment String    @default("sandbox") // 'sandbox' or 'production'
  isActive    Boolean   @default(true) @map("is_active")
  lastUsedAt  DateTime? @map("last_used_at")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([branchId]) // One credential set per branch
  @@map("pathao_credentials")
}

model PathaoStore {
  id String @id @default(uuid())

  branchId String @unique @map("branch_id")
  branch   Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)

  pathaoStoreId    Int     @map("pathao_store_id")
  name             String
  contactName      String  @map("contact_name")
  contactNumber    String  @map("contact_number")
  secondaryContact String? @map("secondary_contact")
  address          String

  // Use Pathao IDs (not our UUID references)
  cityId Int @map("city_id")
  zoneId Int @map("zone_id")
  areaId Int @map("area_id")

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations to master data
  city PathaoCity @relation(fields: [cityId], references: [cityId], onDelete: Restrict)
  zone PathaoZone @relation(fields: [zoneId], references: [zoneId], onDelete: Restrict)
  area PathaoArea @relation(fields: [areaId], references: [areaId], onDelete: Restrict)

  deliveries PathaoDelivery[]

  @@index([branchId])
  @@index([pathaoStoreId])
  @@index([cityId])
  @@index([zoneId])
  @@index([areaId])
  @@map("pathao_stores")
}

model PathaoDelivery {
  id      String @id @default(uuid())
  orderId String @unique

  // Pathao tracking info
  consignmentId String? @unique @map("consignment_id")
  invoiceId     String? @map("invoice_id")

  pathaoStoreId String      @map("pathao_store_id")
  pathaoStore   PathaoStore @relation(fields: [pathaoStoreId], references: [id], onDelete: Restrict)

  // Delivery details
  itemWeight      Float   @map("item_weight") // Changed from Decimal to Float
  itemQuantity    Int     @map("item_quantity")
  amountToCollect Decimal @map("amount_to_collect") @db.Decimal(10, 2)

  // Pricing from Pathao API
  deliveryFee   Decimal? @map("delivery_fee") @db.Decimal(10, 2)
  codCharge     Decimal? @map("cod_charge") @db.Decimal(10, 2)
  promoDiscount Decimal? @map("promo_discount") @db.Decimal(10, 2)
  discount      Decimal? @db.Decimal(10, 2)

  // Location - use Pathao IDs (not our UUID references)
  recipientCityId Int @map("recipient_city_id")
  recipientZoneId Int @map("recipient_zone_id")
  recipientAreaId Int @map("recipient_area_id")

  // Recipient details
  recipientName           String  @map("recipient_name")
  recipientPhone          String  @map("recipient_phone")
  recipientSecondaryPhone String? @map("recipient_secondary_phone")
  recipientAddress        String  @map("recipient_address") @db.Text

  deliveryType Int @default(48) @map("delivery_type") // 48=Normal, 12=Express
  itemType     Int @default(2) @map("item_type") // 1=Document, 2=Parcel

  specialInstruction String? @map("special_instruction") @db.Text
  itemDescription    String? @map("item_description") @db.Text

  // Status tracking
  status String @default("PENDING")

  // Error handling
  errorMessage String?   @map("error_message") @db.Text
  retryCount   Int       @default(0) @map("retry_count")
  lastRetryAt  DateTime? @map("last_retry_at")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  order         Order                         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  city          PathaoCity                    @relation("DeliveryRecipientCity", fields: [recipientCityId], references: [cityId], onDelete: Restrict)
  zone          PathaoZone                    @relation("DeliveryRecipientZone", fields: [recipientZoneId], references: [zoneId], onDelete: Restrict)
  area          PathaoArea                    @relation("DeliveryRecipientArea", fields: [recipientAreaId], references: [areaId], onDelete: Restrict)
  statusHistory PathaoDeliveryStatusHistory[]

  @@index([orderId])
  @@index([consignmentId])
  @@index([status])
  @@index([retryCount])
  @@index([recipientCityId])
  @@index([recipientZoneId])
  @@index([recipientAreaId])
  @@map("pathao_deliveries")
}

model PathaoDeliveryStatusHistory {
  id               String @id @default(uuid())
  pathaoDeliveryId String

  status       String
  pathaoStatus String?
  remarks      String? @db.Text

  metadata Json?

  createdAt DateTime @default(now())

  // Relations
  pathaoDelivery PathaoDelivery @relation(fields: [pathaoDeliveryId], references: [id], onDelete: Cascade)

  @@index([pathaoDeliveryId])
  @@index([createdAt])
  @@map("pathao_delivery_status_history")
}

model PathaoWebhookLog {
  id String @id @default(uuid())

  consignmentId   String?
  merchantOrderId String?

  payload Json
  headers Json?

  processed   Boolean   @default(false)
  processedAt DateTime?
  error       String?   @db.Text

  createdAt DateTime @default(now())

  @@index([consignmentId])
  @@index([merchantOrderId])
  @@index([processed])
  @@index([createdAt])
  @@map("pathao_webhook_logs")
}

// ============================================
// PATHAO LOCATION MASTER DATA
// ============================================

model PathaoCity {
  id       String  @id @default(uuid())
  cityId   Int     @unique @map("city_id")
  name     String  @map("city_name")
  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  zones             PathaoZone[]
  stores            PathaoStore[]
  deliveries        PathaoDelivery[] @relation("DeliveryRecipientCity")
  ordersAsRecipient Order[]          @relation("OrderRecipientCity")

  @@index([cityId])
  @@index([isActive])
  @@map("pathao_cities")
}

model PathaoZone {
  id       String  @id @default(uuid())
  zoneId   Int     @unique @map("zone_id")
  name     String  @map("zone_name")
  cityId   Int     @map("city_id")
  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  city              PathaoCity       @relation(fields: [cityId], references: [cityId], onDelete: Cascade)
  areas             PathaoArea[]
  stores            PathaoStore[]
  deliveries        PathaoDelivery[] @relation("DeliveryRecipientZone")
  ordersAsRecipient Order[]          @relation("OrderRecipientZone")

  @@index([cityId])
  @@index([zoneId])
  @@index([isActive])
  @@map("pathao_zones")
}

model PathaoArea {
  id                    String  @id @default(uuid())
  areaId                Int     @unique @map("area_id")
  name                  String  @map("area_name")
  zoneId                Int     @map("zone_id")
  homeDeliveryAvailable Boolean @default(true) @map("home_delivery_available")
  pickupAvailable       Boolean @default(true) @map("pickup_available")
  isActive              Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  zone              PathaoZone       @relation(fields: [zoneId], references: [zoneId], onDelete: Cascade)
  stores            PathaoStore[]
  deliveries        PathaoDelivery[] @relation("DeliveryRecipientArea")
  ordersAsRecipient Order[]          @relation("OrderRecipientArea")

  @@index([zoneId])
  @@index([areaId])
  @@index([isActive])
  @@map("pathao_areas")
}

model OrderActivity {
  id          String  @id @default(uuid())
  orderId     String
  userId      String?
  action      String // "CREATED", "STATUS_CHANGED", "CANCELLED", etc.
  description String? @db.Text
  metadata    Json? // Additional data (old status, new status, etc.)

  createdAt DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
  user  User? @relation(fields: [userId], references: [id])

  @@index([orderId])
  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@map("order_activities")
}

// NEW MODEL: Sequential Order Number Generator
model OrderSequence {
  id        String   @id @default(uuid())
  date      String   @unique // Format: YYYYMMDD (e.g., "20260220")
  sequence  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("order_sequences")
}

enum OrderStatus {
  PENDING // Order created, inventory reserved, waiting vendor confirmation
  CONFIRMED // Vendor confirmed order
  PROCESSING // Vendor packaging for Pathao
  READY_FOR_PICKUP // Ready, will auto-send Pathao request
  SHIPPED // Given to Pathao worker
  OUT_FOR_DELIVERY // Pathao webhook (future)
  DELIVERED // Pathao webhook (future)
  CANCELLED // Cancelled by customer/vendor
  RETURNED // Customer returned (future)
}

enum DeliveryLocation {
  INSIDE_DHAKA // 70 BDT delivery charge
  OUTSIDE_DHAKA // 120 BDT delivery charge
}

enum PaymentMethod {
  COD // Cash on Delivery (Phase 1)
  BKASH // Future
  NAGAD // Future
  ROCKET // Future
}

enum UserStatus {
  ACTIVE
  INACTIVE
  BLOCKED
}

enum RoleType {
  CUSTOMER
  VENDOR
  ADMIN
  SUPER_ADMIN
}

enum RoleRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum CategoryRequestStatus {
  PENDING
  APPROVED
  REJECTED
}
